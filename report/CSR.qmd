---
title: "CSR"
author: "Pavel"
format: html
editor: visual
---

```{r}
#| include: false
library(tidyverse)
library(kableExtra)
library(knitr)
source("../R/constants.R")
```

## CSR (Casino Strategies Report)

![](pics/ocean.jpeg){fig-align="center" width="300"}

## Solution Specifics

1.  Code As Much As You Can (**functional** code and **tidyverse style** where is possible).
2.  Game simulation and **data wrangling**.
3.  Creating different gaming strategies using common sense and **statistics**.
4.  Finding best strategy backed by statistics.
5.  **Data Visualization** of metrics by different strategies using **ggplot2**.
6.  **Results presentations** with Quarto.

## Casino Rules

1.  Всего `r n_bandits` автоматов.
2.  Из них `r n_bandits-1` автоматов имеют матожидание выигрыша ниже цены игры.
3.  Только один позволяет получить достоверную прибыль игроку в долгосрочной перспективе.
4.  Но победный автомат может быть изменен после `r n_games_change_p` игр для защиты от абьюза данного автомата.

## Basic statistics

Insert expected values of winnings

Add plot of sigmoid plot(1:10000, (\\(x) sigmoid_paramed(x) )(1:10000))

```{r}
#| include: false
exp_losing <- sum(losing_p_distr * winning_sizes)
exp_winning <- sum(winning_p_distr * winning_sizes)
p_losing <- (n_bandits - 1) / n_bandits
p_winning <- 1 / n_bandits
avg_win = p_losing * exp_losing + p_winning * exp_winning
```

-   Всего машин: `r n_bandits`. 
-   Цена игры: `r price`. 
-   У проигрышных машин матожидание выигрыша `r exp_losing |> round(2)`.
-   У выигрышной машины матожидание выигрыша `r exp_winning |> round(2)`.
-   При рандомной стратегии матожидание выигрыша: `r avg_win |> round(2)`.
-   Машина может изменить свою стратегию через `r n_games_change_p` игр.
-   В одной итерации `r n_steps` игр.
-   Для оценки и визуализации каждая стратегия проходила `r n_iters` итераций.
-   При других стратегиях... Не так все просто, но симуляциями можем оценить! (найти, сделать)


## Strategies

1.  Randy\
    Randomly pulls machine, no brain at all
2.  Average man
3.  T shaped man
4.  Biased Bayes
5.  Chi


Потенциальный выигрыш
```{r}
#| echo: false
tibble(winning_sizes, w=winning_p_distr, l=losing_p_distr) |> 
  mutate(w=scales:::percent(w, accuracy=1)) |> 
  mutate(l=scales:::percent(l, accuracy=1)) |> 
  rename(`Размер награды` = winning_sizes) |> 
  kable(format="html",align = "cll") |> 
  kable_styling(full_width = FALSE, bootstrap_options = "striped") 
# |>
  # column_spec(2, bold = T, border_right = T, format = ) 
```


```{r}
#| echo: false
2 * 2
```

## Visualization of strategies

Вставить графики из plots.R
```{r}
#| echo: false
# 1+1
```


## Best strategy

Оценить матожидание

## Conclusions

1.  You will never win in the real casino
2.  Statistics is useful
3.  Simulations are fun and cheap
4.  Write as many functions as possible
